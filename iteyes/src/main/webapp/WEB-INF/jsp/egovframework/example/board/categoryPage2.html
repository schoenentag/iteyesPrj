<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.3.min.js"
	integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
	crossorigin="anonymous"></script>
<title>게시판 카테고리</title>
<link rel="stylesheet" href="/css/board/boardStyle.css">
</head>
</script>
<div class="board_wrap">
        <div class="board_title">
            <strong>게시판 카테고리</strong>
                <p>게시판 카테고리 리스트입니다.</p>
        </div>

        <div class="board_content">
            <ul>
                <select name="category">
                    <option value="category_name">카테고리명</option>
                    <option value="category_name">1카테고리</option>
                    <option value="category_name">2카테고리</option>
                    <option value="category_name">3카테고리</option>
                </select>
                <div class="search">
                    <input type="text" placeholder="검색어를 입력해주세요.">
                    
                    <button>검색</button>
                   
               </div>
                <li><a href="#" onclick="deleteCall()">삭제</a></li>
                <li><a href="/categoryInsertForm.do">등록</a></li>
                <li><a href="#">전체글보기</a></li>
            </ul>
        </div>

        <div class="board_list_wrap">
            <div class="board_list">
                <div class="top">
                    <div class="cbox"></div>
                    <div class="num">번호</div>
                    <div class="title">게시판명</div>
                    <div class="writer">설명</div>
                    <div class="yn">사용여부</div>
                    <div class="name">등록자</div>
                    <div class="runs">이동</div>

                </div>
	                <div id="contentArea" name="contentArea" >
	                </div>
            </div>
            <div class="board_page" id="paginationArea" name="paginationArea">
            </div>

            <!-- <div class="bt_wrap">
                <a href="#" class="on"> 등록 </a>
               <a href="#"> 수정 </a>  
            </div> -->
            
        </div>

    </div>

<script type="text/javascript">

	 let option; //검색할 옵션 값을 담을 변수; N(이름), D(설명), U(관리자명)
	 let keyword;
 	 let list = {"option" : option, "keyword" : keyword};
 	 
 	/*목록 출력하는 ajax와 페이징처리 되는 ajax를 순서대로 호출한다.*/
 	 new Promise( (succ, fail)=>{ 
 	 
 		//첫번째 ajax로 list 출력
	 	$.ajax({
	 		  type: 'post',
	 		  contentType: 'application/json; charset=utf-8',
				  url : '/jsonCategoryList.do',
				  data : JSON.stringify(list),
				  datatype: "JSON",
				  success : function(data) {
					  let td_html = "";
					  
					  for (list of data){
					      td_html += ` <input type="checkbox" class="cbox" name="cbox" data-id="${list.id}">
		                    <div class="num" data-id="${list.id}">${list.id}</div>
		                    <div class="title" data-value="${list.id}" data-id="${list.id}">${list.name}</div>
		                    <div class="writer" data-id="${list.id}">${list.description}</div>
		                    <div class="yn" data-id="${list.id}">${list.useYn}</div>
		                    <div class="name" data-id="${list.id}">${list.regUser}</div>
		                    <div class="run" data-id="${list.id}">></div>`;
					  }
					  
		              $(contentArea).append(td_html);
				  }, 
				  error : function(err){
				    console.log(err);
				}
			}).then((arg) =>{    // 두번째 ajax를 실행한다(페이징 처리)
				let board_html = "";
			   // let data = {"curPage" : pageNum}; 
			
			    $.ajax({
			        url: '/pagination.do',
			        type: 'post',
			        //data : JSON.stringify(data),
					datatype: "JSON",
			        success: function(res) {
			            
			            if(res.curRange != 1){//맨처음
				            board_html+= `<a href="#" class="bt first" onClick="fn_paging(1)" value="1"><<</a> 
				                           <a href="#" class="bt prev" onClick="fn_paging('${res.prevPage}')" value="${res.prevPage}"><</a>`;
			            } 
			                		  
			            for (let i = res.startPage; i <= res.endPage; i++){
			            	if( i == res.curPage){
			            		board_html+= `<a href="#" class="num on" id="pageNum" name="pageNum" value="${i}">${i}</a> `;
			            	}else{
				                board_html+= `<a href="#" class="num" id="pageNum" name="pageNum" value="${i}">${i}</a> `;
			            	}
			            }
			            if( res.curPage != res.pageCnt & res.pageCnt > 0 ){
			                board_html+=`<a href="" class="bt next" onClick="fn_paging('${res.nextPage }')" value="${res.nextPage }">></a>
			                             <a href="" class="bt last" onClick="fn_paging('${res.pageCnt  }')" value="${res.pageCnt }">>></a>`;
			            }
			            $(".board_page").append(board_html);
			        },
			        fail: function(result) {
			            fail(error); 
			        }                                             
			
			    });// 두번째 ajax 끝
			
			});
	    });

	
$("#paginationArea").on("click",".num", function(e){
    console.log("일단 실행됨");
	e.stopPropagation(); // 버블링 차단
});
	
	
	
	// let thiss = $(this);
	 //console.log(thiss);
	    //let curPage = $(this).val();
	   // console.log(curPage);
			 
	 /*function fn_paging(num){
			console.log("fn_paging(num) 함수 실행");
			let curPage = {"curPage" : num}
			  $.ajax({
				  url: '/pagination.do',
			      type: 'post',
			      data : JSON.stringify(curPage),
				  datatype: "JSON",
				  success: function(res) {
				      console.log("fn_paging(num) 통신 성공" + res);
				  },fail: function(result) {
			            fail(error); 
			        } 
			    });//ajax끝 */
	
//=========================	
    var checkBoxArr= []; //체크된 id 값을 담을 배열
    
	/* 삭제 : 체크박스 클릭 -> 삭제버튼 */
	$("#contentArea").on("click",".cbox", function(e){
		e.stopPropagation(); // 버블링 차단
		let tg = e.currentTarget;
		//console.log("tg" , tg);
		
		
		let checkedId = $(tg).data('id'); // 체크된 id값 
		let cbox = $(".cbox"); // checkbox 개수
		//checkBoxArr = checkedId; 
		  
		//for문 돌면서 check 된 id값을 배열에 담는다
		$("input[name='cbox']:checked").each(function(i){   
			
		   //set을 통해서 배열에 담긴 값을 중복제거한다.
           const setCollection = new Set(checkBoxArr.map(JSON.stringify));
           //중복이 있으면 true 반환
           const isDuplicate = setCollection.size < checkBoxArr.length;
           console.log(isDuplicate);
         
			if(!isDuplicate) // 중복이 없으면... add..근데 중복 여전함 ㅜ
			    checkBoxArr.push({"id" : $(tg).data('id')});
			
		});
		  console.log("checkBoxArr" , checkBoxArr);
		  
	})
	 
    function deleteCall(){
		console.log("deleteCall checkBoxArr", checkBoxArr);
		
		 $.ajax({
		    	url:'/categoryDelete.do',
		    	type:'post',
		    	contentType: 'application/json; charset=utf-8',
		    	data : JSON.stringify(checkBoxArr),
		    	datatype: "JSON",
		    	success : function(res){
		    		location.href = "/categoryPage2.do";
		    	},
		    	error : function(err){
		    		console.log(err);
		    	}
		    });
	}
	

  /* 단건 조회 페이지 이동 */
  $("#contentArea").on("click",".title",function(e){
	  e.stopPropagation(); // 버블링 차단
	  let tg = e.currentTarget;
	  let prev = $(tg).prev().html(); //id값
	  location.href = '/categoryDetail.do?id='+prev; //페이지 이동
  })
</script>
</body>
</html>